<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghislain | Expense Tracker</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://kit.fontawesome.com/95ebfc49eb.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="overlay" id="overlay"></div>
    <p id="errorMsg"></p>
    <div class="container">
        <div class="overlay" id="overlay"></div>
        <div class="navbar">
            <nav>
                <h1 id="name">Hey Ghislain</h1>
                <div class="right" id="right">
                    <div class="links" id="links">
                        <ul id="lists">
                            <li class="active"><a href="index.html">Home</a></li>
                            <li><a href="activity.html">Activity</a></li>
                            <li><a href="#">Card</a></li>
                        </ul>
                    </div>
                    <i class="fa-solid fa-bars" id="menu"></i>
                    <i class="fa-solid fa-bell"></i>
                    <i class="fa-solid fa-circle-user"></i>
                    
                </div>
            </nav>
        </div>
        <div class="top">
            <div class="left">
                <div class="card">
                    <p>GC card</p>
                    <h1 class="income"><span class="incomes" id="totalIncome">00.0</span> <span class="span" id="percentIncome">0% income from last month</span></h1>
                    <div class="income-ex">
                        <h1><span class="exp">Expense</span><span class="money" id="expenses">00.0</span></h1>
                        <h1><span class="exp">Balance</span><span class="money" id="balance">00.0</span></h1>
                    </div>
                    <button id="cardAdd"><i class="fa-solid fa-plus"></i></button>
                </div>
            </div>
            <div class="chart">
                <h1>Your Monthly Tracker</h1>
                <img src="17905.jpg" alt="Your Expense Chart">
            </div>
        </div>
        <div class="quick">
            <div class="header">
                <h1>Quick access</h1>
            </div>
            <div class="access">
                <div class="accesses" id="topUpQuick">
                    <i class="fa-solid fa-money-bill-trend-up"></i>
                    <h1>Top Up</h1>
                </div>
                <div class="accesses" id="withdrawQuick">
                    <i class="fa-solid fa-arrow-up-from-bracket"></i>
                    <h1>Withdraw</h1>
                </div>
                <div class="accesses" id="sendQuick">
                    <i class="fa-solid fa-money-bill-transfer"></i>
                    <h1>Send</h1>
                </div>
                <div class="accesses" id="scheduleQuick">
                    <i class="fa-solid fa-calendar-plus"></i>
                    <h1>Schedule</h1>
                </div>
            </div>
        </div>
        <div class="transactions">
            <h1>Transactions</h1>
            <div class="all">
                <div class="all-line">
                    <div class="info">
                        <div class="mouse">
                            <i class="fa-solid fa-money-bill-trend-up"></i>
                            <h1>Top Ups</h1>
                        </div>
                        <h2 id="topps">0.0</h2>
                    </div>
                    <div class="details" onclick="showTopUpDetails()">
                        <i class="fa-solid fa-circle-info"></i>
                        <p>Details</p>
                    </div>
                </div>
                <div class="all-line">
                    <div class="info">
                        <div class="mouse">
                            <i class="fa-solid fa-arrow-up-from-bracket"></i>
                            <h1>Withdraws</h1>
                        </div>
                        <h2 id="withdraws">0.0</h2>
                    </div>
                    <div class="details" onclick="showWithdrawDetails()">
                        <i class="fa-solid fa-circle-info"></i>
                        <p>Details</p>
                    </div>
                </div>
                <div class="all-line">
                    <div class="info">
                        <div class="mouse">
                            <i class="fa-solid fa-money-bill-transfer"></i>
                            <h1>Transfers</h1>
                        </div>
                        <h2 id="transfers">0.0</h2>
                    </div>
                    <div class="details" onclick="showTransferDetails()">
                        <i class="fa-solid fa-circle-info"></i>
                        <p>Details</p>
                    </div>
                </div>
                <div class="all-line">
                    <div class="info">
                        <div class="mouse">
                            <i class="fa-solid fa-coins"></i>
                            <h1>Premium Fee</h1>
                        </div>
                        <h2>0.0</h2>
                    </div>
                    <div class="details" onclick="showPremiumDetails()">
                        <i class="fa-solid fa-circle-info"></i>
                        <p>Details</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <div class="foot">
            <h1>&copy; 2025 Ghislain Expense Tracker . All Rights Reserved</h1>
        </div>
    </footer>
    <div class="load" id="loading">
        <div class="loading">
            <div class="loader"></div>
        </div>
    </div>
    <div class="fill" id="fill">
        <div class="filling">
            <div class="deposit">
                <i class="fa-solid fa-xmark" id="closeFill"></i>
                <form action="" id="form">
                    <h1>Deposit Into Your Card</h1>
                    <label for="name">Name <br>
                        <input type="text" placeholder="Input your name" id="userName" required>
                    </label>
                    <label for="cardNumber"> Card Number <br>
                        <input type="password" name="cardNumber" id="cardNumber" id="cardNumber" required>
                    </label>
                    <label for="Amount"> Amount <br>
                        <input type="number" placeholder="Enter your Amount to deposit" id="depositAmount" class="green">
                    </label>
                    <button type="submit">Proceed to Payment method <i class="fa-solid fa-arrow-right"></i></button>
                </form>
            </div>
        </div>
    </div>
    <div class="fill" id="withdrawFill">
        <div class="filling">
            <div class="deposit">
                <i class="fa-solid fa-xmark" id="closeWithdraw"></i>
                <form action="" id="withdrawForm">
                    <h1>Withdraw From Your Card</h1>
                    <label for="withdrawName">Name <br>
                        <input type="text" placeholder="Input your name" id="withdrawUserName" required>
                    </label>
                    <label for="withdrawMethod"> Withdrawal Method <br>
                        <select id="withdrawMethod" required>
                            <option value="">Select withdrawal method</option>
                            <option value="mobile-money">Mobile Money</option>
                            <option value="orange-money">Orange Money</option>
                        </select>
                    </label>
                    <label for="withdrawReason"> Reason for Withdrawal <br>
                        <input type="text" placeholder="Enter reason for withdrawal" id="withdrawReason" required>
                    </label>
                    <label for="withdrawAmount"> Amount <br>
                        <input type="number" placeholder="Enter amount to withdraw" id="withdrawAmount" class="green">
                    </label>
                    <button type="submit">Proceed to Withdrawal <i class="fa-solid fa-arrow-right"></i></button>
                </form>
            </div>
        </div>
    </div>
    <div class="fill" id="sendFill">
        <div class="filling">
            <div class="deposit">
                <i class="fa-solid fa-xmark" id="closeSend"></i>
                <form action="" id="sendForm">
                    <h1>Send Money</h1>
                    <label for="senderName">Your Name <br>
                        <input type="text" placeholder="Input your name" id="senderName" required>
                    </label>
                    <label for="recipientName"> Recipient Name <br>
                        <input type="text" placeholder="Recipient's name" id="recipientName" required>
                    </label>
                    <label for="recipientPhone"> Recipient Phone <br>
                        <input type="tel" placeholder="Recipient's phone number" id="recipientPhone" required>
                    </label>
                    <label for="sendReason"> Reason for Transfer <br>
                        <input type="text" placeholder="Enter reason for transfer" id="sendReason" required>
                    </label>
                    <label for="sendAmount"> Amount <br>
                        <input type="number" placeholder="Enter amount to send" id="sendAmount" class="green">
                    </label>
                    <button type="submit">Send Money <i class="fa-solid fa-arrow-right"></i></button>
                </form>
            </div>
        </div>
    </div>
    <div class="fill" id="scheduleFill">
        <div class="filling">
            <div class="deposit">
                <i class="fa-solid fa-xmark" id="closeSchedule"></i>
                <form action="" id="scheduleForm">
                    <h1>Schedule Transaction</h1>
                    <label for="scheduleType">Transaction Type <br>
                        <select id="scheduleType" required>
                            <option value="">Select transaction type</option>
                            <option value="withdraw">Withdraw</option>
                            <option value="send">Send Money</option>
                        </select>
                    </label>
                    
                    <!-- Withdraw fields (initially hidden) -->
                    <div id="withdrawFields" style="display: none;">
                        <label for="scheduleWithdrawMethod"> Withdrawal Method <br>
                            <select id="scheduleWithdrawMethod">
                                <option value="">Select withdrawal method</option>
                                <option value="mobile-money">Mobile Money</option>
                                <option value="orange-money">Orange Money</option>
                            </select>
                        </label>
                        <label for="scheduleWithdrawName"> Name <br>
                            <input type="text" placeholder="Input your name" id="scheduleWithdrawName">
                        </label>
                    </div>
                    
                    <!-- Send fields (initially hidden) -->
                    <div id="sendFields" style="display: none;">
                        <label for="scheduleSenderName">Your Name <br>
                            <input type="text" placeholder="Input your name" id="scheduleSenderName">
                        </label>
                        <label for="scheduleRecipientName"> Recipient Name <br>
                            <input type="text" placeholder="Recipient's name" id="scheduleRecipientName">
                        </label>
                        <label for="scheduleRecipientPhone"> Recipient Phone <br>
                            <input type="tel" placeholder="Recipient's phone number" id="scheduleRecipientPhone">
                        </label>
                    </div>
                    
                    <label for="scheduleAmount"> Amount <br>
                        <input type="number" placeholder="Enter amount" id="scheduleAmount" class="green" required>
                    </label>
                    <label for="scheduleReason"> Reason <br>
                        <input type="text" placeholder="Enter reason for transaction" id="scheduleReason" required>
                    </label>
                    <label for="scheduleDate"> Date <br>
                        <input type="date" id="scheduleDate" required>
                    </label>
                    <label for="scheduleTime"> Time <br>
                        <input type="time" id="scheduleTime" required>
                    </label>
                    <button type="submit">Schedule Transaction <i class="fa-solid fa-arrow-right"></i></button>
                </form>
            </div>
        </div>
    </div>
    <div class="fill" id="topUpDetails">
        <div class="filling">
            <div class="deposit">
                <i class="fa-solid fa-xmark" id="closeTopUpDetails"></i>
                <div class="details-content">
                    <h1>Top Up Transaction Details</h1>
                    <div id="topUpDetailsList">
                        <!-- Transaction details will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="fill" id="withdrawDetails">
        <div class="filling">
            <div class="deposit">
                <i class="fa-solid fa-xmark" id="closeWithdrawDetails"></i>
                <div class="details-content">
                    <h1>Withdrawal Transaction Details</h1>
                    <div id="withdrawDetailsList">
                        <!-- Transaction details will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="fill" id="transferDetails">
        <div class="filling">
            <div class="deposit">
                <i class="fa-solid fa-xmark" id="closeTransferDetails"></i>
                <div class="details-content">
                    <h1>Transfer Transaction Details</h1>
                    <div id="transferDetailsList">
                        <!-- Transaction details will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="fill" id="premiumDetails">
        <div class="filling">
            <div class="deposit">
                <i class="fa-solid fa-xmark" id="closePremiumDetails"></i>
                <div class="details-content">
                    <h1>Premium Fee Details</h1>
                    <div id="premiumDetailsList">
                        <!-- Transaction details will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let overlay = document.getElementById('overlay')
        let menu = document.getElementById('menu')
        let lists = document.getElementById('lists')
        let right = document.getElementById('right')
        let links = document.getElementById('links')
        let isOpen = false

        // Mobile menu functionality
        menu.addEventListener('click', function(){
            isOpen = !isOpen
            if(isOpen){
                overlay.style.display = 'block'
                links.style.display = 'block'
                right.style.zIndex = '101'
                right.style.color = '#7ce1ff'
                menu.classList.remove('fa-bars')
                menu.classList.add('fa-xmark')
            }
            else{
                overlay.style.display = 'none'
                links.style.display = 'none'
                right.style.color = '#000'
                menu.classList.remove('fa-xmark')
                menu.classList.add('fa-bars')
                right.style.zIndex = '1'
            }
        })

        overlay.addEventListener('click', () => {
            isOpen = false;
            overlay.style.display = 'none'
            links.style.display = 'none'
            right.style.color = '#000'
            menu.classList.remove('fa-xmark')
            menu.classList.add('fa-bars')
            right.style.zIndex = '1'
        })

        // Global variables
        let message = document.getElementById('errorMsg')
        let cardAdd = document.getElementById('cardAdd')
        let loader = document.getElementById('loading')
        let tot = 0
        let withdrawTotal = 0
        let transferTotal = 0
        let scheduledTransactions = []

        // Quick action buttons
        let topUpQuick = document.getElementById('topUpQuick')
        let withdrawQuick = document.getElementById('withdrawQuick')
        let sendQuick = document.getElementById('sendQuick')
        let scheduleQuick = document.getElementById('scheduleQuick')

        // Modal elements
        let fill = document.getElementById('fill')
        let withdrawFill = document.getElementById('withdrawFill')
        let sendFill = document.getElementById('sendFill')
        let scheduleFill = document.getElementById('scheduleFill')

        // Close buttons
        let closeFill = document.getElementById('closeFill')
        let closeWithdraw = document.getElementById('closeWithdraw')
        let closeSend = document.getElementById('closeSend')
        let closeSchedule = document.getElementById('closeSchedule')

        // Forms
        let form = document.getElementById('form')
        let withdrawForm = document.getElementById('withdrawForm')
        let sendForm = document.getElementById('sendForm')
        let scheduleForm = document.getElementById('scheduleForm')

        // Load data from localStorage on page load
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('expenseTrackerData')
            if (savedData) {
                const data = JSON.parse(savedData)
                tot = data.tot || 0
                withdrawTotal = data.withdrawTotal || 0
                transferTotal = data.transferTotal || 0
                scheduledTransactions = data.scheduledTransactions || []
                
                // Update UI with loaded data
                updateUI()
            }
        }

        // Save data to localStorage
        function saveToLocalStorage() {
            const data = {
                tot: tot,
                withdrawTotal: withdrawTotal,
                transferTotal: transferTotal,
                scheduledTransactions: scheduledTransactions
            }
            localStorage.setItem('expenseTrackerData', JSON.stringify(data))
        }

        // Save transaction to history
        function saveTransactionToHistory(transaction) {
            let transactionHistory = []
            const savedHistory = localStorage.getItem('transactionHistory')
            
            if (savedHistory) {
                transactionHistory = JSON.parse(savedHistory)
            }
            
            transactionHistory.push(transaction)
            localStorage.setItem('transactionHistory', JSON.stringify(transactionHistory))
        }

        // Update UI with current data
        function updateUI() {
            document.getElementById('totalIncome').textContent = `FCFA${tot}.00`
            document.getElementById('balance').textContent = `FCFA${tot - withdrawTotal - transferTotal}.00`
            document.getElementById('expenses').textContent = `FCFA${withdrawTotal + transferTotal}.00`
            document.getElementById('topps').textContent = `+${tot}`
            document.getElementById('withdraws').textContent = `-${withdrawTotal}.0`
            document.getElementById('transfers').textContent = `-${transferTotal}.0`
        }

        // Top Up functionality
        function increment(){
            const depo = document.getElementById('depositAmount').value   
            let values = parseInt(depo)
            
            if(!isNaN(values) && values >= 1000){
                tot += values
                document.getElementById('depositAmount').value = ''
                
                // Save individual transaction to history
                const transaction = {
                    id: Date.now(),
                    type: 'topup',
                    amount: values,
                    date: new Date(),
                    description: 'Top Up',
                    reason: 'Card deposit',
                    method: 'Card payment',
                    icon: 'fa-solid fa-money-bill-trend-up',
                    color: 'green'
                }
                saveTransactionToHistory(transaction)
                
                updateUI()
                saveToLocalStorage()
                console.log('Top up successful')
                xoverla()
                xshowfill()
            }
            else{
                message.style.display = 'inline-block'
                message.textContent = 'Please Enter a valid sum (minimum 1000 FCFA)'
                setTimeout(() =>{
                    message.style.display = 'none'
                }, 2000);
                console.log('Top up error')
            }
        }

        // Withdraw functionality
        function withdraw(){
            const withdrawAmount = document.getElementById('withdrawAmount').value   
            const withdrawMethod = document.getElementById('withdrawMethod').value
            const withdrawReason = document.getElementById('withdrawReason').value
            let values = parseInt(withdrawAmount)
            
            if(!isNaN(values) && values >= 1000 && values <= (tot - withdrawTotal - transferTotal) && withdrawMethod && withdrawReason){
                withdrawTotal += values
                document.getElementById('withdrawAmount').value = ''
                document.getElementById('withdrawMethod').value = ''
                document.getElementById('withdrawReason').value = ''
                
                // Save individual transaction to history
                const transaction = {
                    id: Date.now(),
                    type: 'withdraw',
                    amount: values,
                    date: new Date(),
                    description: 'Withdrawal',
                    reason: withdrawReason,
                    method: withdrawMethod,
                    icon: 'fa-solid fa-arrow-up-from-bracket',
                    color: 'red'
                }
                saveTransactionToHistory(transaction)
                
                updateUI()
                saveToLocalStorage()
                console.log('Withdraw successful')
                xoverla()
                xshowWithdraw()
            }
            else if(values > (tot - withdrawTotal - transferTotal)){
                message.style.display = 'inline-block'
                message.textContent = 'Insufficient balance for withdrawal'
                setTimeout(() =>{
                    message.style.display = 'none'
                }, 2000);
            }
            else if(!withdrawMethod || !withdrawReason){
                message.style.display = 'inline-block'
                message.textContent = 'Please fill all fields'
                setTimeout(() =>{
                    message.style.display = 'none'
                }, 2000);
            }
            else{
                message.style.display = 'inline-block'
                message.textContent = 'Please Enter a valid sum (minimum 1000 FCFA)'
                setTimeout(() =>{
                    message.style.display = 'none'
                }, 2000);
                console.log('Withdraw error')
            }
        }

        // Send functionality
        function sendMoney(){
            const sendAmount = document.getElementById('sendAmount').value   
            const sendReason = document.getElementById('sendReason').value
            const senderName = document.getElementById('senderName').value
            const recipientName = document.getElementById('recipientName').value
            const recipientPhone = document.getElementById('recipientPhone').value
            let values = parseInt(sendAmount)
            
            if(!isNaN(values) && values >= 1000 && values <= (tot - withdrawTotal - transferTotal) && sendReason){
                transferTotal += values
                document.getElementById('sendAmount').value = ''
                document.getElementById('sendReason').value = ''
                
                // Save individual transaction to history
                const transaction = {
                    id: Date.now(),
                    type: 'send',
                    amount: values,
                    date: new Date(),
                    description: 'Money Transfer',
                    reason: sendReason,
                    method: 'Mobile transfer',
                    senderName: senderName,
                    recipientName: recipientName,
                    recipientPhone: recipientPhone,
                    icon: 'fa-solid fa-money-bill-transfer',
                    color: 'red'
                }
                saveTransactionToHistory(transaction)
                
                updateUI()
                saveToLocalStorage()
                console.log('Send money successful')
                xoverla()
                xshowSend()
            }
            else if(values > (tot - withdrawTotal - transferTotal)){
                message.style.display = 'inline-block'
                message.textContent = 'Insufficient balance for transfer'
                setTimeout(() =>{
                    message.style.display = 'none'
                }, 2000);
            }
            else if(!sendReason){
                message.style.display = 'inline-block'
                message.textContent = 'Please fill all fields'
                setTimeout(() =>{
                    message.style.display = 'none'
                }, 2000);
            }
            else{
                message.style.display = 'inline-block'
                message.textContent = 'Please Enter a valid sum (minimum 1000 FCFA)'
                setTimeout(() =>{
                    message.style.display = 'none'
                }, 2000);
                console.log('Send money error')
            }
        }

        // Schedule functionality
        function scheduleTransaction(){
            const scheduleType = document.getElementById('scheduleType').value
            const scheduleAmount = document.getElementById('scheduleAmount').value
            const scheduleDate = document.getElementById('scheduleDate').value
            const scheduleTime = document.getElementById('scheduleTime').value
            const scheduleReason = document.getElementById('scheduleReason').value
            
            // Get additional fields based on transaction type
            let additionalData = {}
            if(scheduleType === 'withdraw') {
                const withdrawMethod = document.getElementById('scheduleWithdrawMethod').value
                const withdrawName = document.getElementById('scheduleWithdrawName').value
                if(!withdrawMethod || !withdrawName) {
                    message.style.display = 'inline-block'
                    message.textContent = 'Please fill all withdraw fields'
                    setTimeout(() =>{
                        message.style.display = 'none'
                    }, 2000);
                    return
                }
                additionalData = { method: withdrawMethod, name: withdrawName }
            } else if(scheduleType === 'send') {
                const senderName = document.getElementById('scheduleSenderName').value
                const recipientName = document.getElementById('scheduleRecipientName').value
                const recipientPhone = document.getElementById('scheduleRecipientPhone').value
                if(!senderName || !recipientName || !recipientPhone) {
                    message.style.display = 'inline-block'
                    message.textContent = 'Please fill all send fields'
                    setTimeout(() =>{
                        message.style.display = 'none'
                    }, 2000);
                    return
                }
                additionalData = { senderName, recipientName, recipientPhone }
            }
            
            if(scheduleType && scheduleAmount && scheduleDate && scheduleTime && scheduleReason){
                let values = parseInt(scheduleAmount)
                if(!isNaN(values) && values >= 1000 && values <= (tot - withdrawTotal - transferTotal)){
                    const scheduledDateTime = new Date(`${scheduleDate}T${scheduleTime}`)
                    const now = new Date()
                    
                    if(scheduledDateTime > now){
                        const transaction = {
                            type: scheduleType,
                            amount: values,
                            dateTime: scheduledDateTime,
                            reason: scheduleReason,
                            ...additionalData,
                            id: Date.now()
                        }
                        scheduledTransactions.push(transaction)
                        
                        message.style.display = 'inline-block'
                        message.textContent = `Transaction scheduled for ${scheduleDate} at ${scheduleTime}`
                        message.style.color = '#00ff00'
                        setTimeout(() =>{
                            message.style.display = 'none'
                            message.style.color = '#f00'
                        }, 3000);
                        
                        // Clear all form fields
                        document.getElementById('scheduleAmount').value = ''
                        document.getElementById('scheduleDate').value = ''
                        document.getElementById('scheduleTime').value = ''
                        document.getElementById('scheduleType').value = ''
                        document.getElementById('scheduleReason').value = ''
                        document.getElementById('scheduleWithdrawMethod').value = ''
                        document.getElementById('scheduleWithdrawName').value = ''
                        document.getElementById('scheduleSenderName').value = ''
                        document.getElementById('scheduleRecipientName').value = ''
                        document.getElementById('scheduleRecipientPhone').value = ''
                        
                        // Hide dynamic fields
                        document.getElementById('withdrawFields').style.display = 'none'
                        document.getElementById('sendFields').style.display = 'none'
                        
                        saveToLocalStorage()
                        console.log('Transaction scheduled successfully')
                        xoverla()
                        xshowSchedule()
                    } else {
                        message.style.display = 'inline-block'
                        message.textContent = 'Please select a future date and time'
                        setTimeout(() =>{
                            message.style.display = 'none'
                        }, 2000);
                    }
                } else if(values > (tot - withdrawTotal - transferTotal)){
                    message.style.display = 'inline-block'
                    message.textContent = 'Insufficient balance for scheduled transaction'
                    setTimeout(() =>{
                        message.style.display = 'none'
                    }, 2000);
                } else {
                    message.style.display = 'inline-block'
                    message.textContent = 'Please Enter a valid sum (minimum 1000 FCFA)'
                    setTimeout(() =>{
                        message.style.display = 'none'
                    }, 2000);
                }
            } else {
                message.style.display = 'inline-block'
                message.textContent = 'Please fill all fields'
                setTimeout(() =>{
                    message.style.display = 'none'
                }, 2000);
            }
        }

        // Check scheduled transactions
        function checkScheduledTransactions(){
            const now = new Date()
            let hasExecuted = false
            
            scheduledTransactions = scheduledTransactions.filter(transaction => {
                if(transaction.dateTime <= now){
                    // Execute the transaction
                    if(transaction.type === 'withdraw'){
                        withdrawTotal += transaction.amount
                        hasExecuted = true
                    } else if(transaction.type === 'send'){
                        transferTotal += transaction.amount
                        hasExecuted = true
                    }
                    
                    return false // Remove from array
                }
                return true // Keep in array
            })
            
            if(hasExecuted) {
                updateUI()
                saveToLocalStorage()
                
                message.style.display = 'inline-block'
                message.textContent = `Scheduled transaction executed successfully`
                message.style.color = '#00ff00'
                setTimeout(() =>{
                    message.style.display = 'none'
                    message.style.color = '#f00'
                }, 3000);
            }
        }

        // Check scheduled transactions every 10 seconds for better responsiveness
        setInterval(checkScheduledTransactions, 10000)

        // Event listeners for forms
        form.addEventListener('submit', function(e){
            e.preventDefault()
            increment()
        })

        withdrawForm.addEventListener('submit', function(e){
            e.preventDefault()
            withdraw()
        })

        sendForm.addEventListener('submit', function(e){
            e.preventDefault()
            sendMoney()
        })

        scheduleForm.addEventListener('submit', function(e){
            e.preventDefault()
            scheduleTransaction()
        })

        // Schedule type change event listener
        document.getElementById('scheduleType').addEventListener('change', function() {
            const scheduleType = this.value
            const withdrawFields = document.getElementById('withdrawFields')
            const sendFields = document.getElementById('sendFields')
            
            // Hide all dynamic fields first
            withdrawFields.style.display = 'none'
            sendFields.style.display = 'none'
            
            // Show appropriate fields based on selection
            if(scheduleType === 'withdraw') {
                withdrawFields.style.display = 'block'
                // Make withdraw fields required
                document.getElementById('scheduleWithdrawMethod').required = true
                document.getElementById('scheduleWithdrawName').required = true
                // Make send fields not required
                document.getElementById('scheduleSenderName').required = false
                document.getElementById('scheduleRecipientName').required = false
                document.getElementById('scheduleRecipientPhone').required = false
            } else if(scheduleType === 'send') {
                sendFields.style.display = 'block'
                // Make send fields required
                document.getElementById('scheduleSenderName').required = true
                document.getElementById('scheduleRecipientName').required = true
                document.getElementById('scheduleRecipientPhone').required = true
                // Make withdraw fields not required
                document.getElementById('scheduleWithdrawMethod').required = false
                document.getElementById('scheduleWithdrawName').required = false
            } else {
                // No selection, make all fields not required
                document.getElementById('scheduleWithdrawMethod').required = false
                document.getElementById('scheduleWithdrawName').required = false
                document.getElementById('scheduleSenderName').required = false
                document.getElementById('scheduleRecipientName').required = false
                document.getElementById('scheduleRecipientPhone').required = false
            }
        })

        // Quick action button event listeners
        topUpQuick.addEventListener('click', function(){
            overla()
            showLoader()
            showfill()
        })

        withdrawQuick.addEventListener('click', function(){
            overla()
            showLoader()
            showWithdraw()
        })

        sendQuick.addEventListener('click', function(){
            overla()
            showLoader()
            showSend()
        })

        scheduleQuick.addEventListener('click', function(){
            overla()
            showLoader()
            showSchedule()
        })

        // Card add button
        cardAdd.addEventListener('click', function(){
            overla()
            showLoader()
            showfill()
        })

        // Close button event listeners
        closeFill.addEventListener('click', function(){
            xoverla()
            xshowfill()
        })

        closeWithdraw.addEventListener('click', function(){
            xoverla()
            xshowWithdraw()
        })

        closeSend.addEventListener('click', function(){
            xoverla()
            xshowSend()
        })

        closeSchedule.addEventListener('click', function(){
            xoverla()
            xshowSchedule()
        })

        // Modal functions
        function overla(){
            overlay.style.display = 'block'
            document.body.style.overflow = 'hidden'
        }

        function xoverla(){
            overlay.style.display = 'none'
            document.body.style.overflow = 'visible'
        }

        function showLoader(){
            loader.style.display = 'block'
            setTimeout(() => {
                loader.style.display = 'none'
            }, 4000)
        }

        function showfill(){
            setTimeout(() => {
                fill.style.display = 'block'
            }, 5000)
        }

        function xshowfill(){
            fill.style.display = 'none'
        }

        function showWithdraw(){
            setTimeout(() => {
                withdrawFill.style.display = 'block'
            }, 5000)
        }

        function xshowWithdraw(){
            withdrawFill.style.display = 'none'
        }

        function showSend(){
            setTimeout(() => {
                sendFill.style.display = 'block'
            }, 5000)
        }

        function xshowSend(){
            sendFill.style.display = 'none'
        }

        function showSchedule(){
            setTimeout(() => {
                scheduleFill.style.display = 'block'
            }, 5000)
        }

        function xshowSchedule(){
            scheduleFill.style.display = 'none'
        }

        // Load data when page loads
        loadFromLocalStorage()

        // Function to show Top Up transaction details
        function showTopUpDetails() {
            const transactions = JSON.parse(localStorage.getItem('transactionHistory') || '[]');
            const topUpTransactions = transactions.filter(t => t.type === 'topup');

            if (topUpTransactions.length === 0) {
                alert('No Top Up transactions found.');
                return;
            }

            const detailsList = document.getElementById('topUpDetailsList');
            detailsList.innerHTML = topUpTransactions.map(t => `
                <div class="transaction-detail-item">
                    <div class="detail-header">
                        <i class="fa-solid fa-money-bill-trend-up" style="color: #28a745;"></i>
                        <span class="amount">+FCFA ${t.amount.toLocaleString()}</span>
                    </div>
                    <div class="detail-info">
                        <p><strong>Date:</strong> ${new Date(t.date).toLocaleDateString()} at ${new Date(t.date).toLocaleTimeString()}</p>
                        <p><strong>Reason:</strong> ${t.reason || 'N/A'}</p>
                        <p><strong>Method:</strong> ${t.method || 'N/A'}</p>
                        <p><strong>Transaction ID:</strong> ${t.id.toString().slice(-6)}</p>
                    </div>
                </div>
            `).join('');

            overla();
            showTopUpDetailsModal();
        }

        // Function to show Withdrawal transaction details
        function showWithdrawDetails() {
            const transactions = JSON.parse(localStorage.getItem('transactionHistory') || '[]');
            const withdrawTransactions = transactions.filter(t => t.type === 'withdraw');

            if (withdrawTransactions.length === 0) {
                alert('No Withdrawal transactions found.');
                return;
            }

            const detailsList = document.getElementById('withdrawDetailsList');
            detailsList.innerHTML = withdrawTransactions.map(t => `
                <div class="transaction-detail-item">
                    <div class="detail-header">
                        <i class="fa-solid fa-arrow-up-from-bracket" style="color: #dc3545;"></i>
                        <span class="amount">-FCFA ${t.amount.toLocaleString()}</span>
                    </div>
                    <div class="detail-info">
                        <p><strong>Date:</strong> ${new Date(t.date).toLocaleDateString()} at ${new Date(t.date).toLocaleTimeString()}</p>
                        <p><strong>Reason:</strong> ${t.reason || 'N/A'}</p>
                        <p><strong>Method:</strong> ${t.method || 'N/A'}</p>
                        <p><strong>Transaction ID:</strong> ${t.id.toString().slice(-6)}</p>
                    </div>
                </div>
            `).join('');

            overla();
            showWithdrawDetailsModal();
        }

        // Function to show Transfer transaction details
        function showTransferDetails() {
            const transactions = JSON.parse(localStorage.getItem('transactionHistory') || '[]');
            const transferTransactions = transactions.filter(t => t.type === 'send');

            if (transferTransactions.length === 0) {
                alert('No Transfer transactions found.');
                return;
            }

            const detailsList = document.getElementById('transferDetailsList');
            detailsList.innerHTML = transferTransactions.map(t => `
                <div class="transaction-detail-item">
                    <div class="detail-header">
                        <i class="fa-solid fa-money-bill-transfer" style="color: #dc3545;"></i>
                        <span class="amount">-FCFA ${t.amount.toLocaleString()}</span>
                    </div>
                    <div class="detail-info">
                        <p><strong>Date:</strong> ${new Date(t.date).toLocaleDateString()} at ${new Date(t.date).toLocaleTimeString()}</p>
                        <p><strong>Reason:</strong> ${t.reason || 'N/A'}</p>
                        <p><strong>Method:</strong> ${t.method || 'N/A'}</p>
                        <p><strong>Sender:</strong> ${t.senderName || 'N/A'}</p>
                        <p><strong>Recipient:</strong> ${t.recipientName || 'N/A'}</p>
                        <p><strong>Phone:</strong> ${t.recipientPhone || 'N/A'}</p>
                        <p><strong>Transaction ID:</strong> ${t.id.toString().slice(-6)}</p>
                    </div>
                </div>
            `).join('');

            overla();
            showTransferDetailsModal();
        }

        // Function to show Premium Fee details
        function showPremiumDetails() {
            const transactions = JSON.parse(localStorage.getItem('transactionHistory') || '[]');
            const premiumTransactions = transactions.filter(t => t.type === 'premium');

            if (premiumTransactions.length === 0) {
                alert('No Premium Fee transactions found.');
                return;
            }

            const detailsList = document.getElementById('premiumDetailsList');
            detailsList.innerHTML = premiumTransactions.map(t => `
                <div class="transaction-detail-item">
                    <div class="detail-header">
                        <i class="fa-solid fa-coins" style="color: #ffc107;"></i>
                        <span class="amount">-FCFA ${t.amount.toLocaleString()}</span>
                    </div>
                    <div class="detail-info">
                        <p><strong>Date:</strong> ${new Date(t.date).toLocaleDateString()} at ${new Date(t.date).toLocaleTimeString()}</p>
                        <p><strong>Reason:</strong> ${t.reason || 'N/A'}</p>
                        <p><strong>Transaction ID:</strong> ${t.id.toString().slice(-6)}</p>
                    </div>
                </div>
            `).join('');

            overla();
            showPremiumDetailsModal();
        }

        // Modal display functions
        function showTopUpDetailsModal() {
            setTimeout(() => {
                document.getElementById('topUpDetails').style.display = 'block';
            }, 1000);
        }

        function showWithdrawDetailsModal() {
            setTimeout(() => {
                document.getElementById('withdrawDetails').style.display = 'block';
            }, 1000);
        }

        function showTransferDetailsModal() {
            setTimeout(() => {
                document.getElementById('transferDetails').style.display = 'block';
            }, 1000);
        }

        function showPremiumDetailsModal() {
            setTimeout(() => {
                document.getElementById('premiumDetails').style.display = 'block';
            }, 1000);
        }

        // Close modal functions
        function closeTopUpDetails() {
            document.getElementById('topUpDetails').style.display = 'none';
            xoverla();
        }

        function closeWithdrawDetails() {
            document.getElementById('withdrawDetails').style.display = 'none';
            xoverla();
        }

        function closeTransferDetails() {
            document.getElementById('transferDetails').style.display = 'none';
            xoverla();
        }

        function closePremiumDetails() {
            document.getElementById('premiumDetails').style.display = 'none';
            xoverla();
        }

        // Event listeners for close buttons
        document.getElementById('closeTopUpDetails').addEventListener('click', closeTopUpDetails);
        document.getElementById('closeWithdrawDetails').addEventListener('click', closeWithdrawDetails);
        document.getElementById('closeTransferDetails').addEventListener('click', closeTransferDetails);
        document.getElementById('closePremiumDetails').addEventListener('click', closePremiumDetails);
    </script>
</body>
</html>